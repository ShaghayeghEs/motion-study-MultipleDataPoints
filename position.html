<!DOCTYPE html>
<html>
  <meta charset="utf-8" />
  <head>
    <title>Position Encoding</title>
    <link
      href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
      rel="stylesheet"
    />

    <!-- Custom styles for this template-->
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <link rel="stylesheet" href="./styles/dropdown.css" />
    <link rel="stylesheet" href="./styles/simple-style.css" />
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <link rel="stylesheet" href="./styles/dropdown.css" />
    <link rel="stylesheet" href="./styles/simple-style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <script src="./libraries/d3.js"></script>
    <script src="./libraries/jquery-3.2.1.min.js"></script>
    <script src="./libraries/timeme.js"></script>
    <script type="text/javascript">
      var params = location.href.split("?")[1].split("&");
      url_data = {};
      for (ele of params) {
        ele = ele.split("=");
        url_data[ele[0]] = ele[1];
      }
      TimeMe.initialize({
        currentPageName: "position", // page name
        idleTimeoutInSeconds: 15 // time before user considered idle
      });
    </script>
  </head>

  <body>
    <div id="chart"></div>
    <div id="test" style="margin-left:25%;">
      How many times farther is the <b>position of circle 2</b> compared to the
      <b>position of circle 1</b>?
    </div>
    <div id="ranger" style="width:45%;margin-left:25%;">
      <input
        type="range"
        class="slider"
        min="1"
        max="20"
        step="0.1"
        name="speed"
        id="value2"
        value="1"
      />
      <br /><br />
      &nbsp;&nbsp;Value: <span id="demo"></span>
    </div>

    <div id="last">
      <br />
      <br />
      <button class="button" id="submit" style="margin-left:25%;">
        Submit
      </button>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <br /><br /><br />
    </div>

    <script src="./libraries/d3.v5.min.js"></script>
    <script src="./scripts/position_encoding.js"></script>
    <script>
      var slider = document.getElementById("value2");
      var output = document.getElementById("demo");
      output.innerHTML = slider.value;

      slider.oninput = function() {
        output.innerHTML = this.value;
      };
      function postMessage(timeSpentOnPage) {
        var xhr = new XMLHttpRequest();
        xhr.open(
          "POST",
          "https://siddheshgupte2.pythonanywhere.com/store_data/",
          false
        );
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.send(
          JSON.stringify({
            participant_id: url_data["id"],
            ratio: parseFloat(url_data["ratio"]),
            trial_number: parseInt(url_data["trail"]),
            time_spent: timeSpentOnPage,
            participant_answer: slider.value,
            correct_answer: 10,
            type_of_encoding: "position",
            difference: 10 - slider.value
          })
        );

        if (xhr.status == 200) {
          console.log("made request");
          window.top.load_page();
        } else {
          console.log("Error sending msg to the server...retrying");
          postMessage();
        }
      }
      var btn = document.getElementById("submit");
      btn.onclick = function() {
        btn.disabled = true;
        //btn.style.background = "#e8e7d8";
        var timeSpentOnPage = TimeMe.getTimeOnCurrentPageInSeconds();
        postMessage(timeSpentOnPage);
      };
    </script>
  </body>
</html>
