<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Vertical Motion Circle</title>
  <script src="https://d3js.org/d3.v6.min.js"></script>
</head>
<body>
  <div id="chart"></div>

  <script>
    var width = 600;
    var height = 600;
    
    var svg = d3
      .select("#chart")
      .append("svg")
      .attr("width", width)
      .attr("height", height);

    var cell_data = [];

    for (var i = 0; i < 10; i++) {
      for (var j = 0; j < 10; j++) {
        cell_data.push({
          x: i * 60,
          y: j * 60
        });
      }
    }

    var cells = svg
      .selectAll(".cell")
      .data(cell_data)
      .enter()
      .append("rect")
      .attr("class", "cell")
      .attr("x", function(d) {
        return d.x;
      })
      .attr("y", function(d) {
        return d.y;
      })
      .attr("width", 60)
      .attr("height", 60)
      .style("stroke", "black")
      .style("fill", "none")
      .style("stroke-width", 1);

    var radius = 10;

    var circle_data = [];

    for (var i = 0; i < 10; i++) {
      for (var j = 0; j < 10; j++) {
        circle_data.push({
          x: i * 60 + 30,
          y: j * 60 + 30,
          y_initial: j * 60 + 30,
          y_diff: 0.5,
          speed: Math.random() + 0.5, // Assign a random speed for each circle between 0.5 and 1.5
        });
      }
    }

    var circles = svg
      .selectAll(".circle")
      .data(circle_data)
      .enter()
      .append("circle")
      .attr("class", "circle")
      .attr("r", radius)
      .attr("fill", "#008fb3")
      .attr("cx", function(d) {
        return d.x;
      })
      .attr("cy", function(d) {
        return d.y;
      });

    var m_s = 0.2;
    var m_s1 = m_s / 0.2;
    var move_true = true;

    var t = d3.timer(animate);

    function animate(elapsed) {
      circles
        .attr("cy", function(d) {
          if (move_true) {
            d.y = d.y + d.speed * m_s1 * d.y_diff;
            if (d.y <= d.y_initial - 30 + radius || d.y >= d.y_initial + 30 - radius) {
              d.y_diff = d.y_diff * -1;
            }
            return d.y;
          } else return d.y;
        })
        .attr("cx", function(d) {
          return d.x;
        });
    }
  </script>
</body>
</html>
