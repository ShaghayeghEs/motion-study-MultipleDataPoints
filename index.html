<!DOCTYPE html>
<html>
  <head>
    <title>Multiple Data Points Graphs</title>

    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- CSS -->
    <link rel="stylesheet" href="./styles/dropdown.css" />
    <link rel="stylesheet" href="./styles/simple-style.css" />
    
    <script>
    </script>
  </head>

  <body>
    <!-- <div id="heading">
      <h2 style="text-align:center;">
        Encoding Quantitative Data with Various Visualizations
      </h2>
    </div> -->

    <div id="myBox">
      <embed
        src="./MultipleDataPointsStudy-InformedConsent.pdf"
        width="100%"
        height="100%"
      />
    </div>
    
    <!-- style="margin-left:40%;" -->
    <button id="submitForm" class="button" type="button" value="Submit">
      Accept and Continue
    </button>


    <script>
    document.getElementById("submitForm").addEventListener("click", function () {
  console.log("Submit button clicked.");
  fetchMaxParticipantId()
    .then(lastParticipantId => {
      const newParticipantId = (!lastParticipantId || isNaN(lastParticipantId)) ? 1 : (parseInt(lastParticipantId) + 1).toString();
      localStorage.setItem("participantId", newParticipantId);
      console.log("New Participant ID set in local storage:", newParticipantId);

      // Now proceed to the next page
      window.location.href = "./parent.html";
    })
    .catch(error => {
      console.error("Error fetching last participant ID:", error);
      // Handle error, maybe show a message to the user
    });
});


        
function fetchMaxParticipantId() {
    return new Promise((resolve, reject) => {
        fetch("json/log.json")
            .then(response => response.text())
            .then(data => {
                if (!data || data.trim() === "") {
                    resolve("0");
                } else {
                    const lines = data.trim().split("\n");
                    let maxId = 0;
                    lines.forEach(line => {
                        try {
                            const entry = JSON.parse(line);
                            const participantId = parseInt(entry.participant_id);
                            if (!isNaN(participantId) && participantId > maxId) {
                                maxId = participantId;
                            }
                        } catch (error) {
                            // You can handle parsing errors here if needed
                        }
                    });
                    resolve(maxId.toString());
                }
            })
            .catch(error => {
                reject(error);
            });
    });
}







      </script>

  </body>
</html>
