<!DOCTYPE html>
<html>
  <head>
    <title>Multiple Data Points Graphs</title>

    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- CSS -->
    <link rel="stylesheet" href="./styles/dropdown.css" />
    <link rel="stylesheet" href="./styles/simple-style.css" />
    
    <script>
      function proceed() {
        window.location.href = "./parent.html";
      }
    </script>
  </head>

  <body>
    <!-- <div id="heading">
      <h2 style="text-align:center;">
        Encoding Quantitative Data with Various Visualizations
      </h2>
    </div> -->

    <div id="myBox">
      <embed
        src="./MultipleDataPointsStudy-InformedConsent.pdf"
        width="100%"
        height="100%"
      />
    </div>
    
    <!-- style="margin-left:40%;" -->
    <button
      id="submitForm"
      class="button"
      
      type="button"
      value="Submit"
      onClick="proceed()"
    >
      Accept and Continue
    </button>


    <script>
document.getElementById("submitForm").addEventListener("click", function () {
    fetchLastParticipantId()
        .then(lastParticipantId => {
            // If lastParticipantId is not a number, default to 0
            lastParticipantId = isNaN(lastParticipantId) ? 0 : parseInt(lastParticipantId);

            // Compute the new participant ID
            const newParticipantId = lastParticipantId + 1;

            // Store the new participant ID in localStorage
            localStorage.setItem("participantId", newParticipantId.toString());

            window.location.href = "parent.html";
        })
        .catch(error => {
            console.error("Error fetching last participant ID:", error);
        });
});

function fetchLastParticipantId() {
    return new Promise((resolve, reject) => {
        fetch("json/log.json")
            .then(response => response.text()) // Get the response as text
            .then(text => {
                // Split the text into lines and parse each line as JSON
                const lines = text.split('\n');
                let maxParticipantId = 0;

                lines.forEach(line => {
                    try {
                        const entry = JSON.parse(line);
                        if (entry && entry.participant_id) {
                            const participantId = parseInt(entry.participant_id);
                            if (!isNaN(participantId)) {
                                maxParticipantId = Math.max(maxParticipantId, participantId);
                            }
                        }
                    } catch (e) {
                        // Handle possible JSON parsing errors
                        console.error("Error parsing line:", e);
                    }
                });

                resolve(maxParticipantId);
            })
            .catch(error => {
                console.error("Error fetching log.json:", error);
                resolve(0);
            });
    });
}

      </script>

  </body>
</html>
