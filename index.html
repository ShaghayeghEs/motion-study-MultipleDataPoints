<!DOCTYPE html>
<html>
  <head>
    <title>Multiple Data Points Graphs</title>

    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- CSS -->
    <link rel="stylesheet" href="./styles/dropdown.css" />
    <link rel="stylesheet" href="./styles/simple-style.css" />
    
    <script>
      function proceed() {
        window.location.href = "./parent.html";
      }
    </script>
  </head>

  <body>
    <!-- <div id="heading">
      <h2 style="text-align:center;">
        Encoding Quantitative Data with Various Visualizations
      </h2>
    </div> -->

    <div id="myBox">
      <embed
        src="./MultipleDataPointsStudy-InformedConsent.pdf"
        width="100%"
        height="100%"
      />
    </div>
    
    <!-- style="margin-left:40%;" -->
    <button
      id="submitForm"
      class="button"
      
      type="button"
      value="Submit"
      onClick="proceed()"
    >
      Accept and Continue
    </button>


    <script>

      document.getElementById("submitForm").addEventListener("click", function () {
                  // Fetch the content of log.json and parse it
                  fetchLastParticipantId()
                      .then(lastParticipantId => {
                          // If log.json is empty or there's an error, set the participant ID to "1"
                          const newParticipantId = (lastParticipantId === null || isNaN(lastParticipantId)) ? "1" : (parseInt(lastParticipantId) + 1).toString();
          
                          // Store the new participant ID and condition
                          localStorage.setItem("participantId", newParticipantId);          
                          window.location.href = "parent.html";
                      })
                      .catch(error => {
                          console.error("Error fetching last participant ID:", error);
                      });
              });
          
              function fetchLastParticipantId() {
                  return new Promise((resolve, reject) => {
                      // Fetch the content of log.json and parse it
                      fetch("json/log.json")
                          .then(response => response.json())
                          .then(data => {
                              // Check if the data is empty
                              if (!data || data.length === 0) {
                                  resolve(null); // If log.json is empty, return null
                              } else {
                                  // Find the largest participant ID in the log
                                  let maxParticipantId = 0;
                                  data.forEach(entry => {
                                      const participantId = parseInt(entry.participantId);
                                      if (!isNaN(participantId)) {
                                          maxParticipantId = Math.max(maxParticipantId, participantId);
                                      }
                                  });
                                  resolve(maxParticipantId.toString());
                              }
                          })
                          .catch(error => {
                              reject(error);
                          });
                  });
              }

      </script>


  </body>
</html>
